app.controller("FiltriController",["$scope","FiltriService","GeneralService","$location","$anchorScroll","$sce","$timeout",function(k,a,f,e,g,j,c){k.contents=[];k.renderContent=[];k.renderContentSecondModel=[];k.calendar=[];k.secondModelId="";k.filters="";k.events=[];k.renderEventContent=[];k.categoryContent=[];k.dayName=[];k.loader=[];k.full=[];k.empty=false;const d=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];k.setParameters=function(r,l,s,t,q,n,o,m,p){k.pageSize=parseInt(r);if(q!=""){k.categorie=q}if(l!=""){k.maxElements=parseInt(l)}if(m!=""){k.filters=m}if(o!=undefined){k.secondModelId=o}if(p){k.setContents(p)}else{k.getContents(s,t,q,n)}};k.setCalendarParameters=function(l,o,m){k.oneMonth=true;k.day=l;k.finemese=o;k.days=o-l;for(i=0;i<=k.days;i++){k.calendar[i]=i+parseInt(k.day);k.full[k.calendar[i]]=true}if(k.days<=9){k.oneMonth=false;var n=new Date();k.nextMonth=d[n.getMonth()+1];k.daysOld=angular.copy(k.days)+1;k.day=1;k.finemese=10-k.days;k.days=k.finemese-k.day;for(i=0;i<=k.days;i++){k.calendar[i+k.daysOld]=i+parseInt(k.day);k.full[k.calendar[i+k.daysOld]]=true}}};k.getContents=function(q,p,o,n,m,l){k.countEmpty=0;if(m!=undefined){k.filters=m}k.currentPage=0;k.pages=[];if(n){b(n,k.oldElem);k.oldElem=n}a.getContents(q,o,k.filters,l).then(function(r){k.events[l]=[];if(r==undefined){k.full[l]=false;k.countEmpty=k.countEmpty+1}if(r!=undefined){k.loader[l]=true;if(!Array.isArray(r)){if(r.$){k.contents=[];k.contents[0]=r;k.events[l].push(r)}}else{if(k.maxElements>=r.length){k.contents=r;k.events[l]=r}else{for(s=0;s<k.maxElements;s++){k.contents[s]=r[s];k.events[l]=r[s]}}}k.numberOfPages=Math.ceil(k.contents.length/k.pageSize);for(s=0;s<k.numberOfPages;s++){k.pages[s]=s+1}for(var s in k.contents){a.getContent(k.contents[s].$,p).then(function(t){k.renderContent[t.item.id]=j.trustAsHtml(t.html)},function(t){console.error("Errore durante il caricamento del contenuto")})}if(k.secondModelId!=""){for(var s in k.contents){a.getContent(k.contents[s].$,k.secondModelId).then(function(t){k.renderContentSecondModel[t.item.id]=j.trustAsHtml(t.html)},function(t){console.error("Errore durante il caricamento del contenuto")})}}if(l!=undefined){k.renderEventContent[l]=[];k.categoryContent[l]=[];for(var s in k.events[l]){a.getContent(k.events[l][s].$,p).then(function(t){k.renderEventContent[l][t.item.id]=j.trustAsHtml(t.html);k.loader[l]=false;k.categoryContent[l][t.item.id]="";for(var u in t.item.categories.category){if(t.item.categories.category[u]!=undefined){k.categoryContent[l][t.item.id]+=t.item.categories.category[u]}}},function(t){k.loader[l]=false;console.error("Errore durante il caricamento del contenuto")})}}}else{k.contents=[]}if(k.countEmpty!=k.calendar.length&&q=="EVN"){c(h,1000)}else{k.empty=true}},function(r){k.contents=[];k.loader[l]=false})};function b(m,l){if(l){var o=document.getElementById(l);$(o).removeClass("active")}if(m!=""){var n=document.getElementById(m);$(n).addClass("active")}}k.goToPage=function(l){k.currentPage=l};k.goToFirstPage=function(){k.currentPage=0};k.refreshPage=function(){k.currentPage=1;c(k.goToFirstPage,1000)};k.getFilterDay=function(l,p,n){var o=parseInt(p)-1;var m=new Date(n,o,l);k.dayName[l]=m.toLocaleString(undefined,{weekday:"short"});return"(attributeFilter=true;key=data_iniz;start="+l+"/"+p+"/"+n+";end="+l+"/"+p+"/"+n+")"};k.setContents=function(m){k.contents=m.replace(/=/g,'":"');k.contents=k.contents.replace(/}/g,'"}');k.contents=k.contents.replace(/contentId/g,'"contentId').replace(/modelId/g,'"modelId');k.contents=k.contents.replace(/, "/g,'", "');k.contents=JSON.parse(k.contents);if(k.pageSize!=0){k.numberOfPages=Math.ceil(k.contents.length/k.pageSize)}else{k.numberOfPages=1}k.pages=[];k.currentPage=0;for(l=0;l<k.numberOfPages;l++){k.pages[l]=l+1}for(var l in k.contents){a.getContent(k.contents[l].contentId,k.contents[l].modelId).then(function(n){k.renderContent[n.item.id]=j.trustAsHtml(n.html)},function(n){console.error("Errore durante il caricamento del contenuto")})}};function h(){var l=$("#owl-calendario");l.owlCarousel({nav:false,startPosition:0,autoPlay:false,responsiveClass:true,responsive:{0:{items:1,},576:{items:2,},768:{items:3,},991:{items:4,},}})}}]);app.filter("startFrom",function(){return function(a,b){b=+b;return a.slice(b)}});